"use strict";(self.webpackChunkmx_ink_webxr_babylonjs=self.webpackChunkmx_ink_webxr_babylonjs||[]).push([[156],{49156:(e,a,i)=>{i.d(a,{$:()=>c});var t=i(90972),n=i(69891),o=i(93375),s=i(7786),r=i(89859);class l{constructor(e,a,i,t){this.name=e,this.worldAxisForNormal=a,this.worldAxisForFileX=i,this.worldAxisForFileY=t}}class c{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const a=e.getSize().width,i=e.readPixels(0,void 0,void 0,!1),t=e.readPixels(1,void 0,void 0,!1);let n,o;e.isRenderTarget?(n=e.readPixels(3,void 0,void 0,!1),o=e.readPixels(2,void 0,void 0,!1)):(n=e.readPixels(2,void 0,void 0,!1),o=e.readPixels(3,void 0,void 0,!1));const s=e.readPixels(4,void 0,void 0,!1),r=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let c=0;return 1!=e.textureType&&2!=e.textureType||(c=1),new Promise((e=>{Promise.all([t,i,n,o,s,r]).then((([i,t,n,o,s,r])=>{const d={size:a,right:t,left:i,up:n,down:o,front:s,back:r,format:5,type:c,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(d))}))}))}static _AreaElement(e,a){return Math.atan2(e*a,Math.sqrt(e*e+a*a+1))}static ConvertCubeMapToSphericalPolynomial(e){const a=new o._;let i=0;const t=2/e.size,l=t,c=.5*t,d=c-1;for(let o=0;o<6;o++){const w=this._FileFaces[o],P=e[w.name];let m=d;const h=5===e.format?4:3;for(let o=0;o<e.size;o++){let p=d;for(let l=0;l<e.size;l++){const d=w.worldAxisForFileX.scale(p).add(w.worldAxisForFileY.scale(m)).add(w.worldAxisForNormal);d.normalize();const v=this._AreaElement(p-c,m-c)-this._AreaElement(p-c,m+c)-this._AreaElement(p+c,m-c)+this._AreaElement(p+c,m+c);let x=P[o*e.size*h+l*h+0],_=P[o*e.size*h+l*h+1],u=P[o*e.size*h+l*h+2];isNaN(x)&&(x=0),isNaN(_)&&(_=0),isNaN(u)&&(u=0),0===e.type&&(x/=255,_/=255,u/=255),e.gammaSpace&&(x=Math.pow((0,n.Clamp)(x),s.Nn),_=Math.pow((0,n.Clamp)(_),s.Nn),u=Math.pow((0,n.Clamp)(u),s.Nn));const C=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(x,_,u);if(e>C){const a=C/e;x*=a,_*=a,u*=a}}else x=(0,n.Clamp)(x,0,C),_=(0,n.Clamp)(_,0,C),u=(0,n.Clamp)(u,0,C);const f=new r.Wo(x,_,u);a.addLight(d,f,v),i+=v,p+=t}m+=l}}const w=4*Math.PI*6/6/i;return a.scaleInPlace(w),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),o.i.FromHarmonics(a)}}c._FileFaces=[new l("right",new t.P(1,0,0),new t.P(0,0,-1),new t.P(0,-1,0)),new l("left",new t.P(-1,0,0),new t.P(0,0,1),new t.P(0,-1,0)),new l("up",new t.P(0,1,0),new t.P(1,0,0),new t.P(0,0,1)),new l("down",new t.P(0,-1,0),new t.P(1,0,0),new t.P(0,0,-1)),new l("front",new t.P(0,0,1),new t.P(1,0,0),new t.P(0,-1,0)),new l("back",new t.P(0,0,-1),new t.P(-1,0,0),new t.P(0,-1,0))],c.MAX_HDRI_VALUE=4096,c.PRESERVE_CLAMPED_COLORS=!1}}]);